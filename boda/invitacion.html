<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Invitación | Reserva el Día</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;900&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Alex+Brush&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/assets/css/styles-invitacion.css">
</head>
<body>
  <main class="main-content">
    <section class="portada">
      <div class="portada-parallax">
        <div class="portada-contenido">
          <p class="subtitulo">¡Nos Casamos!</p>
          <h1 class="titulo-nombres" id="nombres">...</h1>
          <img src="/invitaciones/Clasica/assets/img/portada-editable1.png" alt="Hoja decorativa" class="imagen-portada">
        </div>
      </div>
    </section>

    <section id="cuentaRegresiva" class="cuenta-regresiva text-center py-5">
      <h2>¡Faltan pocos días para el gran día!</h2>
      <div id="mensaje-reloj"></div>
      <div id="reloj" class="d-flex justify-content-center align-items-center fade-in">
        <div class="time-unit"><p class="num_cuenta" id="dias">00</p><p>días</p></div>
        <p class="num_cuenta-separador">:</p>
        <div class="time-unit"><p class="num_cuenta" id="horas">00</p><p>hs</p></div>
        <p class="num_cuenta-separador">:</p>
        <div class="time-unit"><p class="num_cuenta" id="min">00</p><p>min</p></div>
        <p class="num_cuenta-separador">:</p>
        <div class="time-unit"><p class="num_cuenta" id="seg">00</p><p>seg</p></div>
      </div>
    </section>

    <section class="text-center py-5">
      <img src="/assets/img/icono-anillos.svg" alt="Anillos" class="icon fade-in">
      <h4>Nuestra boda</h4>
      <p id="datos-evento"></p>
    </section>

    <footer class="text-center py-4">
      <p>&copy; 2025 Reserva el Día - Todos los derechos reservados</p>
    </footer>
  </main>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.7.1/firebase-app.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/11.7.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyALCvU48_HRp26cXpQcTX5S33Adpwfl3z4",
      authDomain: "reservaeldia-7a440.firebaseapp.com",
      projectId: "reservaeldia-7a440",
      storageBucket: "reservaeldia-7a440.firebasestorage.app",
      messagingSenderId: "860495975406",
      appId: "1:860495975406:web:3a49ad0cf55d60313534ff",
      measurementId: "G-NPTJQXS655"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const params = new URLSearchParams(window.location.search);
    const id = params.get("id");

    if (!id) {
      document.body.innerHTML = "<p class='text-center py-5'>❌ Invitación no válida.</p>";
    } else {
      const ref = doc(db, "invitaciones", id);
      getDoc(ref).then(docSnap => {
        if (docSnap.exists()) {
          const data = docSnap.data();
          document.getElementById("nombres").outerHTML = data.nombres;
          const fechaHoraCeremonia = data.fechaCeremonia && data.horaCeremonia ? `${data.fechaCeremonia} a las ${data.horaCeremonia} hs` : "";
          const datosEvento = fechaHoraCeremonia + (data.lugar ? ` en ${data.lugar}` : '') + ". ¡Te esperamos!";
          document.getElementById("datos-evento").innerHTML = datosEvento;
          fechaEvento = new Date(data.fechaCeremonia + 'T00:00:00');
          iniciarCuentaRegresiva();
        } else {
          document.body.innerHTML = "<p class='text-center py-5'>❌ Invitación no encontrada.</p>";
        }
      });
    }

    /////// Efecto Parallax //////
    window.addEventListener("scroll", function () {
      const portada = document.querySelector(".portada-parallax");
      const offset = window.scrollY;
      if (portada) {
        portada.style.transform = `translateY(${offset * -0.3}px)`;
      }
    });

    //////// Cuenta regresiva //////
    let fechaEvento = null;
    function iniciarCuentaRegresiva() {
      if (!fechaEvento) return;
      clearInterval(window.intervaloCuenta);
      window.intervaloCuenta = setInterval(() => {
        const ahora = new Date();
        const diferencia = fechaEvento - ahora;
        if (diferencia <= 0) {
          document.getElementById("reloj").style.display = "none";
          document.getElementById("mensaje-reloj").innerText = "¡Llegó el gran día!";
          clearInterval(window.intervaloCuenta);
          return;
        }
        const dias = Math.floor(diferencia / (1000 * 60 * 60 * 24));
        const horas = Math.floor((diferencia / (1000 * 60 * 60)) % 24);
        const minutos = Math.floor((diferencia / (1000 * 60)) % 60);
        const segundos = Math.floor((diferencia / 1000) % 60);
        document.getElementById("dias").innerText = String(dias).padStart(2, "0");
        document.getElementById("horas").innerText = String(horas).padStart(2, "0");
        document.getElementById("min").innerText = String(minutos).padStart(2, "0");
        document.getElementById("seg").innerText = String(segundos).padStart(2, "0");
      }, 1000);
    }

    ////// fade-in //////
    const fadeElements = document.querySelectorAll('.fade-in');
    const observer = new IntersectionObserver(entries => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('visible');
          observer.unobserve(entry.target);
        }
      });
    }, { threshold: 0.1 });
    fadeElements.forEach(el => observer.observe(el));
  </script>
</body>
</html>
